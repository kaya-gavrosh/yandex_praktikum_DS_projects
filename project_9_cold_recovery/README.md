# Восстановление золота из руды

## Данные

Данные с оборудования, контролирующего процесс очистки. Данные в трех таблица: тестовая выборка, обучающая и таблица с полными данными. 

## Цель

Разработка прототипа модели для предсказания коэффициент восстановления золота из золотосодержащей руды.

## Детали исследования

Процесс очистки двухэтапный. Использовать можно только те данные, которые уже известны к конкретному моменту очистки.

## Используемые библиотеки:

- pandas
- matplotlib 
- numpy
- scipy
- missingno
- sklearn

## Выводы

Необходимо было решить задачу регресси для прогноза двух величин:
- эффективность обогащения чернового концентрата `rougher.output.recovery`;
- эффективность обогащения финального концентрата `final.output.recovery`.

Ход работы:
1. Данные были загружены (три таблицы с обучающей, тестовой выборками и таблица с полным набором данных). Проведен первичный осмотр. Выявлено наличие пропусков и несоответсвие столбца `date` типу DateTime.
2. Проверен расчет для признака `rougher.output.recovery`. Признак рассчитан правильно, поскольку MAE близко к нулю.
3. Найдены признаки, не вошедшие в тестовую выборку. В тестовом датасете присутствуют входные параметры и параметры текущего состояния этапа обогащения, но выходные (в т.ч. параметры, характеризующие финальный этап) и расчетные параметры отсутствуют. Отсуствие части признаков в тестовой выборке говорит о том, что для построения моделей необходимо использовать признаки, входящие в тестовый набор.
4. Данные предобработаны. 
    - Столбец `date` приведет к необходимому виду.
    - Пропуски проанализированы. Больше всего пропусков наблюдается в столбце `secondary_cleaner.output.tail_sol` (8 и 11% в полной и обучающей выборках соответсвенно). 
    - Поскольку общее число строк с пропусками в полной и тестовой выборках составляет более 20%, было решено заполнить пропуски соседними значениями. Такое решение обусловленно тем, что соседние строки имеют близкие значения.
3. Построены распределения концентрация металлов (Au, Ag, Pb) на различных этапах очистки.  
    - Au: концентрация золота растет на каждом этапе очистки, как и ожидалось
    - Ag: концентрация серебра падает в процессе, как и ожидалось
    - Pb: концентрация свинца увеличилась после флотации, далее не изменялась
4. Проверены распределения размеров гранул сырья на обучающей и тестовой выборках. Распределения мало отличаются
5. Построены распределения суммарной концентрации всех веществ на разных стадиях: в сырье, в черновом и финальном концентратах. В распределении суммарной концентрации есть аномалия около нуля. Поскольку суммарная нулевая концентрация не имеет физического смысл,  аномальные значения были удалены.
6. Написана функция для вычисления sMAPE.
7. Подготовлены признаки для прогноза обех величин. Признаки были отмасштабированы с помощью z-преобразования. Далее построены модели регрессии. Определена лучшая модель по метрике sMAPE.
8. Модель протестирована на тестовой выборке  и посчитана итоговая метрика.

Лучшая модель для `rougher.output.recovery`: RandomForestRegressor(max_depth=7, max_features='sqrt', n_estimators=60, random_state=12345)
<br>Лучшая модель для `final.output.recovery`: RandomForestRegressor(max_depth=5, max_features='sqrt', n_estimators=65, random_state=12345)

Итоговое sMAPE на обучающей: 8.39 %
<br>Итоговое sMAPE на тестовой: 6.59 %